
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Specifying configuration for mite journeys &#8212; mite  documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Design and deployment" href="design-deployment.html" />
    <link rel="prev" title="Volume model specification" href="volume-model.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="specifying-configuration-for-mite-journeys">
<h1>Specifying configuration for mite journeys<a class="headerlink" href="#specifying-configuration-for-mite-journeys" title="Permalink to this headline">¶</a></h1>
<p>All mite journey functions are passed a <code class="docutils literal notranslate"><span class="pre">config</span></code> property on their
<code class="docutils literal notranslate"><span class="pre">context</span></code> argument.  This implements a generic key-value storage
system for managing journey configuration.  Journey functions can call
<code class="docutils literal notranslate"><span class="pre">context.config.get(&quot;key&quot;)</span></code> to retrieve the value set for a given key.</p>
<p>Managing configuration in this way, rather than as values in python
files, has several advantages:</p>
<ul class="simple">
<li><p>It is easy to parameterize tests for different environments</p></li>
<li><p>Sensitive data (IP addresses, passwords) can be stored separately from
test journey code and encrypted (we use <a class="reference external" href="https://github.com/AGWA/git-crypt">git-crypt</a> for this purpose
in a dedicated journeys-and-scenarios repository at Sky, where our
tests need to use auth credentials to talk to some of the endpoints we
test).</p></li>
<li><p>The configuration can be dynamically modified by scenario functions</p></li>
</ul>
<p>There are several ways to provide configuration values to mite when it
is invoked, which are explained in the following sections</p>
<div class="section" id="via-environment-variables">
<h2>Via environment variables<a class="headerlink" href="#via-environment-variables" title="Permalink to this headline">¶</a></h2>
<p>By default, if no other configuration is specified, mite looks in the
process environment.  All environment variables with names of the form
<code class="docutils literal notranslate"><span class="pre">MITE_CONF_key</span></code> are mapped to config entries under <code class="docutils literal notranslate"><span class="pre">key</span></code>.  This
method is convenient for use at the command line when testing journeys.
It also combines well with certain external config/secret management
solutions that are designed to work with environment variables (for
instance, <a class="reference external" href="https://kubernetes.io/docs/concepts/configuration/secret/#using-secrets-as-environment-variables">kubernetes secrets</a>).</p>
</div>
<div class="section" id="via-a-python-callable">
<h2>Via a python callable<a class="headerlink" href="#via-a-python-callable" title="Permalink to this headline">¶</a></h2>
<p>Similarly to the way that scenarios and journeys are specified as a
string of <code class="docutils literal notranslate"><span class="pre">python.module:name_in_module</span></code>, configuration may also be
specified in the same way with the <code class="docutils literal notranslate"><span class="pre">--config</span></code> command line argument.
The python object pointed to in this way should be a function which
returns a dictionary of configuration.</p>
</div>
<div class="section" id="single-values-on-the-command-line">
<h2>Single values on the command line<a class="headerlink" href="#single-values-on-the-command-line" title="Permalink to this headline">¶</a></h2>
<p>It is also possible to set single config values on the command line,
using the argument <code class="docutils literal notranslate"><span class="pre">--add-to-config=key:value</span></code>.  This will add a
setting of <code class="docutils literal notranslate"><span class="pre">key</span></code> to <code class="docutils literal notranslate"><span class="pre">value</span></code> in the existing configuration which
has already been set by one of the above two methods.</p>
</div>
<div class="section" id="dynamically-in-the-scenario-function">
<h2>Dynamically in the scenario function<a class="headerlink" href="#dynamically-in-the-scenario-function" title="Permalink to this headline">¶</a></h2>
<p>The scenario function, if it accepts an argument, will be passed the
config object.  The scenario function can then call
<code class="docutils literal notranslate"><span class="pre">config.set(&quot;key&quot;,</span> <span class="pre">&quot;value&quot;)</span></code> in order to change values in the
configuration.</p>
<p>Some of what this functionality accomplishes could be duplicated by the
callable-returning-dictionary config method above.  However, there are
advantages to the redundancy.  We have tended to use the
callable-returning-dictionary method for storing configuration related
to the system under test (including sensitive information that is
encrypted).  We use the dynamic setting of config in the scenario
function to set config values that are related to the load profile of
the test.  The latter information is more logically placed in the
scenario function (which also manages the load profile in other ways,
such as through the volume model).  It also brings the benefit of not
being encrypted, so that this code can benefit from the full versioning
capabilities of our SCM.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">mite</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=sky-uk&repo=mite&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="components.html">Mite components</a></li>
<li class="toctree-l1"><a class="reference internal" href="journeys.html">Writing mite journeys and scenarios</a></li>
<li class="toctree-l1"><a class="reference internal" href="volume-model.html">Volume model specification</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Specifying configuration for mite journeys</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#via-environment-variables">Via environment variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="#via-a-python-callable">Via a python callable</a></li>
<li class="toctree-l2"><a class="reference internal" href="#single-values-on-the-command-line">Single values on the command line</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dynamically-in-the-scenario-function">Dynamically in the scenario function</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="design-deployment.html">Design and deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="prometheus.html">Prometheus and mite</a></li>
<li class="toctree-l1"><a class="reference internal" href="stats.html">Customizing miteʼs stats</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="volume-model.html" title="previous chapter">Volume model specification</a></li>
      <li>Next: <a href="design-deployment.html" title="next chapter">Design and deployment</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Sky UK - Identity performance engineers.
      
      |
      <a href="_sources/config.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/sky-uk/mite" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>